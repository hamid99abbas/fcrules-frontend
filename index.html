<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FootballLaw â€” Laws of the Game AI</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,600;1,9..40,300&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* â”€â”€â”€ RESET & BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --pitch-dark:   #0a1a0e;
      --pitch-mid:    #0f2614;
      --pitch-light:  #14321a;
      --line-white:   #e8f5ea;
      --stripe-a:     #0f2614;
      --stripe-b:     #112c17;
      --grass-glow:   rgba(34, 197, 94, 0.07);
      --lime:         #84cc16;
      --lime-bright:  #a3e635;
      --amber:        #f59e0b;
      --red-card:     #ef4444;
      --yellow-card:  #eab308;
      --white-70:     rgba(232,245,234,0.7);
      --white-40:     rgba(232,245,234,0.4);
      --white-15:     rgba(232,245,234,0.15);
      --white-08:     rgba(232,245,234,0.08);
      --border:       rgba(232,245,234,0.12);
      --shadow-lg:    0 20px 60px rgba(0,0,0,0.6);
      --r-sm: 6px;
      --r-md: 12px;
      --r-lg: 20px;
      --font-display: 'Bebas Neue', sans-serif;
      --font-body:    'DM Sans', sans-serif;
      --font-mono:    'JetBrains Mono', monospace;
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: var(--font-body);
      background-color: var(--pitch-dark);
      color: var(--line-white);
      min-height: 100vh;
      overflow-x: hidden;
      cursor: default;
      font-size: 16px;
    }

    /* â”€â”€â”€ PITCH STRIPE BACKGROUND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .pitch-bg {
      position: fixed; inset: 0; z-index: 0;
      background-image: repeating-linear-gradient(
        180deg,
        var(--stripe-a) 0px, var(--stripe-a) 60px,
        var(--stripe-b) 60px, var(--stripe-b) 120px
      );
      opacity: 0.6;
    }

    /* radial spotlight overlay */
    .pitch-bg::after {
      content: '';
      position: absolute; inset: 0;
      background: radial-gradient(ellipse 80% 60% at 50% 30%,
        rgba(34,197,94,0.08) 0%,
        rgba(10,26,14,0.0) 60%,
        rgba(10,26,14,0.7) 100%
      );
    }

    /* pitch lines watermark */
    .pitch-lines {
      position: fixed; inset: 0; z-index: 0; pointer-events: none;
      opacity: 0.04;
      background-image:
        linear-gradient(var(--line-white) 1px, transparent 1px),
        linear-gradient(90deg, var(--line-white) 1px, transparent 1px);
      background-size: 80px 80px;
    }

    /* â”€â”€â”€ NOISE GRAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .grain {
      position: fixed; inset: 0; z-index: 999; pointer-events: none;
      opacity: 0.025;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    }

    /* â”€â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .app {
      position: relative; z-index: 1;
      display: grid;
      grid-template-rows: auto 1fr auto;
      min-height: 100vh;
    }

    /* â”€â”€â”€ HERO / HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .hero {
      padding: 48px 24px 32px;
      text-align: center;
      animation: fadeDown 0.7s ease both;
    }

    .badge {
      display: inline-flex; align-items: center; gap: 8px;
      background: var(--white-08);
      border: 1px solid var(--border);
      border-radius: 100px;
      padding: 6px 16px;
      font-size: 11px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--lime);
      margin-bottom: 20px;
      font-family: var(--font-mono);
    }

    .badge-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--lime);
      animation: pulse 1.8s ease infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.4; transform: scale(0.8); }
    }

    h1 {
      font-family: var(--font-display);
      font-size: clamp(52px, 10vw, 96px);
      line-height: 0.9;
      letter-spacing: 0.03em;
      color: var(--line-white);
      margin-bottom: 4px;
    }

    h1 span.accent {
      color: var(--lime-bright);
      text-shadow: 0 0 40px rgba(163,230,53,0.4);
    }

    .hero-sub {
      font-size: 15px;
      color: var(--white-70);
      font-weight: 300;
      margin-top: 12px;
      letter-spacing: 0.02em;
    }

    /* â”€â”€â”€ STATS ROW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .stats-row {
      display: flex;
      justify-content: center;
      gap: 32px;
      flex-wrap: wrap;
      margin-top: 28px;
      animation: fadeDown 0.9s ease both;
    }

    .stat {
      display: flex; flex-direction: column; align-items: center; gap: 2px;
    }

    .stat-val {
      font-family: var(--font-display);
      font-size: 28px;
      color: var(--line-white);
      letter-spacing: 0.04em;
    }

    .stat-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--white-40);
      font-family: var(--font-mono);
    }

    /* â”€â”€â”€ MAIN CHAT AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-wrapper {
      max-width: 900px;
      margin: 0 auto;
      width: 100%;
      padding: 0 20px 24px;
      display: flex;
      flex-direction: column;
      gap: 0;
      animation: fadeUp 0.7s ease both;
    }

    /* â”€â”€â”€ SESSION CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .session-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      background: var(--white-08);
      border: 1px solid var(--border);
      border-radius: var(--r-md);
      margin-bottom: 16px;
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--white-40);
    }

    .session-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .session-indicator {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--lime);
      animation: pulse 2s ease infinite;
    }

    .new-session-btn {
      background: var(--white-08);
      border: 1px solid var(--border);
      color: var(--white-70);
      padding: 4px 12px;
      border-radius: 100px;
      font-size: 10px;
      font-family: var(--font-mono);
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .new-session-btn:hover {
      background: var(--white-15);
      color: var(--lime-bright);
      border-color: rgba(132,204,22,0.3);
    }

    /* â”€â”€â”€ PITCH DIVIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .pitch-divider {
      display: flex; align-items: center; gap: 16px;
      margin-bottom: 24px;
      animation: fadeUp 0.8s 0.1s ease both;
      opacity: 0; animation-fill-mode: forwards;
    }

    .pitch-divider::before,
    .pitch-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border), transparent);
    }

    .pitch-divider span {
      font-family: var(--font-mono);
      font-size: 10px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--white-40);
    }

    /* â”€â”€â”€ MESSAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .messages {
      display: flex;
      flex-direction: column;
      gap: 20px;
      min-height: 320px;
      max-height: 52vh;
      overflow-y: auto;
      padding: 4px 2px 16px;
      scrollbar-width: thin;
      scrollbar-color: var(--white-15) transparent;
    }

    .messages::-webkit-scrollbar { width: 4px; }
    .messages::-webkit-scrollbar-track { background: transparent; }
    .messages::-webkit-scrollbar-thumb { background: var(--white-15); border-radius: 99px; }

    /* empty state */
    .empty-state {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 48px 24px;
      gap: 32px;
    }

    .ball-icon {
      width: 64px; height: 64px;
      opacity: 0.15;
      animation: spin 12s linear infinite;
    }

    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    .empty-state p {
      font-size: 14px;
      color: var(--white-40);
      text-align: center;
      max-width: 340px;
      line-height: 1.7;
      font-style: italic;
    }

    /* suggested questions */
    .suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      max-width: 600px;
    }

    .suggestion-btn {
      background: var(--white-08);
      border: 1px solid var(--border);
      border-radius: 100px;
      padding: 8px 18px;
      font-size: 12px;
      color: var(--white-70);
      font-family: var(--font-body);
      cursor: pointer;
      transition: all 0.2s;
      line-height: 1.4;
    }

    .suggestion-btn:hover {
      background: var(--white-15);
      border-color: rgba(132,204,22,0.3);
      color: var(--lime-bright);
      transform: translateY(-1px);
    }

    /* message bubbles */
    .msg {
      display: flex;
      gap: 14px;
      animation: fadeUp 0.35s ease both;
    }

    .msg.user { flex-direction: row-reverse; }

    .msg-avatar {
      width: 34px; height: 34px;
      border-radius: 50%;
      flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 14px;
      font-weight: 600;
      margin-top: 2px;
    }

    .msg.user .msg-avatar {
      background: linear-gradient(135deg, var(--lime) 0%, #16a34a 100%);
      color: var(--pitch-dark);
      font-family: var(--font-display);
      letter-spacing: 0.05em;
    }

    .msg.ai .msg-avatar {
      background: var(--white-08);
      border: 1px solid var(--border);
      color: var(--lime);
      font-family: var(--font-display);
    }

    .msg-body { flex: 1; max-width: calc(100% - 48px); }

    .msg.user .msg-body { align-items: flex-end; display: flex; flex-direction: column; }

    .msg-bubble {
      border-radius: var(--r-lg);
      padding: 14px 18px;
      font-size: 14px;
      line-height: 1.65;
      max-width: 90%;
    }

    .msg.user .msg-bubble {
      background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
      color: white;
      border-bottom-right-radius: var(--r-sm);
    }

    .msg.ai .msg-bubble {
      background: var(--white-08);
      border: 1px solid var(--border);
      color: var(--line-white);
      border-bottom-left-radius: var(--r-sm);
      backdrop-filter: blur(12px);
    }

    .msg-meta {
      font-size: 10px;
      color: var(--white-40);
      margin-top: 6px;
      font-family: var(--font-mono);
      display: flex; align-items: center; gap: 8px;
    }

    .msg.ai .msg-meta { padding-left: 2px; }
    .msg.user .msg-meta { padding-right: 2px; flex-direction: row-reverse; }

    /* context badge */
    .context-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: rgba(163,230,53,0.1);
      border: 1px solid rgba(163,230,53,0.2);
      border-radius: 100px;
      padding: 2px 8px;
      font-size: 9px;
      color: var(--lime-bright);
      font-family: var(--font-mono);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    /* â”€â”€â”€ AI ANSWER FORMATTING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .ai-answer { white-space: pre-wrap; }

    .ai-answer .law-tag {
      display: inline-block;
      background: rgba(132,204,22,0.12);
      border: 1px solid rgba(132,204,22,0.25);
      color: var(--lime-bright);
      font-family: var(--font-mono);
      font-size: 10px;
      letter-spacing: 0.1em;
      padding: 2px 8px;
      border-radius: 4px;
      margin-right: 6px;
      text-transform: uppercase;
    }

    /* â”€â”€â”€ EVIDENCE ACCORDION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .evidence-toggle {
      display: inline-flex; align-items: center; gap: 6px;
      font-size: 11px;
      color: var(--lime);
      font-family: var(--font-mono);
      cursor: pointer;
      background: none; border: none;
      padding: 0;
      margin-top: 10px;
      transition: opacity 0.2s;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .evidence-toggle:hover { opacity: 0.7; }

    .evidence-toggle .chevron {
      transition: transform 0.25s;
      font-size: 10px;
    }

    .evidence-toggle.open .chevron { transform: rotate(180deg); }

    .evidence-panel {
      margin-top: 10px;
      display: none;
      flex-direction: column;
      gap: 8px;
    }

    .evidence-panel.open { display: flex; }

    .evidence-item {
      background: var(--white-08);
      border: 1px solid var(--border);
      border-left: 2px solid rgba(132,204,22,0.35);
      border-radius: var(--r-sm);
      padding: 10px 14px;
    }

    .evidence-cite {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--lime);
      letter-spacing: 0.06em;
      margin-bottom: 4px;
    }

    .evidence-text {
      font-size: 12px;
      color: var(--white-70);
      line-height: 1.6;
    }

    /* â”€â”€â”€ TYPING INDICATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .typing-indicator {
      display: flex; align-items: center; gap: 5px;
      padding: 14px 18px;
      background: var(--white-08);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      border-bottom-left-radius: var(--r-sm);
      width: fit-content;
      backdrop-filter: blur(12px);
    }

    .typing-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--lime);
      animation: typing-bounce 1.2s ease infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing-bounce {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
      30% { transform: translateY(-6px); opacity: 1; }
    }

    /* â”€â”€â”€ INPUT AREA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .input-area {
      display: flex;
      flex-direction: column;
      gap: 12px;
      padding-top: 8px;
    }

    .input-shell {
      display: flex;
      align-items: flex-end;
      gap: 10px;
      background: var(--white-08);
      border: 1px solid var(--border);
      border-radius: var(--r-lg);
      padding: 12px 14px;
      transition: border-color 0.25s, box-shadow 0.25s;
      backdrop-filter: blur(16px);
    }

    .input-shell:focus-within {
      border-color: rgba(132,204,22,0.4);
      box-shadow: 0 0 0 3px rgba(132,204,22,0.07), 0 8px 32px rgba(0,0,0,0.3);
    }

    #question-input {
      flex: 1;
      background: none; border: none; outline: none;
      color: var(--line-white);
      font-family: var(--font-body);
      font-size: 14px;
      line-height: 1.6;
      resize: none;
      min-height: 22px;
      max-height: 120px;
      overflow-y: auto;
      scrollbar-width: none;
    }

    #question-input::-webkit-scrollbar { display: none; }

    #question-input::placeholder { color: var(--white-40); }

    .send-btn {
      width: 38px; height: 38px; flex-shrink: 0;
      background: linear-gradient(135deg, var(--lime) 0%, #16a34a 100%);
      border: none; border-radius: 50%;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      transition: transform 0.2s, box-shadow 0.2s, opacity 0.2s;
      color: var(--pitch-dark);
    }

    .send-btn:hover { transform: scale(1.07); box-shadow: 0 4px 20px rgba(132,204,22,0.4); }
    .send-btn:active { transform: scale(0.95); }
    .send-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }

    .input-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2px;
    }

    .input-hint {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--white-40);
      letter-spacing: 0.08em;
    }

    .kbd {
      display: inline-block;
      background: var(--white-08);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 1px 5px;
      font-size: 9px;
    }

    /* â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    footer {
      padding: 0 24px 28px;
      margin-top: 16px;
    }

    .footer-rule {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border), var(--border), transparent);
      margin-bottom: 20px;
    }

    .footer-inner {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
      max-width: 900px;
      margin: 0 auto;
    }

    .footer-copy {
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--white-40);
      letter-spacing: 0.08em;
    }

    .footer-copy a {
      color: var(--white-40);
      text-decoration: none;
      transition: color 0.2s;
    }
    .footer-copy a:hover { color: var(--white-70); }

    .footer-brand {
      display: flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      transition: opacity 0.2s;
    }
    .footer-brand:hover { opacity: 0.75; }

    .footer-brand-label {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 1px;
    }

    .footer-brand-built {
      font-family: var(--font-mono);
      font-size: 9px;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--white-40);
    }

    .footer-brand-name {
      font-family: var(--font-display);
      font-size: 15px;
      letter-spacing: 0.06em;
      color: var(--line-white);
      line-height: 1;
    }

    .footer-brand-mark {
      width: 28px; height: 28px;
      border-radius: 6px;
      background: var(--white-08);
      border: 1px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      color: var(--lime);
      flex-shrink: 0;
    }

    .footer-brand-mark svg {
      width: 18px;
      height: 18px;
      color: var(--lime);
    }

    /* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toast {
      position: fixed;
      bottom: 24px; right: 24px;
      background: var(--pitch-light);
      border: 1px solid var(--border);
      border-radius: var(--r-md);
      padding: 12px 18px;
      font-size: 13px;
      color: var(--line-white);
      z-index: 1000;
      transform: translateY(80px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      max-width: 320px;
      backdrop-filter: blur(16px);
    }

    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.error { border-color: rgba(239,68,68,0.4); }

    /* â”€â”€â”€ ANIMATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes fadeDown {
      from { opacity: 0; transform: translateY(-16px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* â”€â”€â”€ SCROLLBAR FOR MESSAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .messages { scroll-behavior: smooth; }

    /* â”€â”€â”€ PROCESSING TIME BADGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .perf-badge {
      display: inline-flex; align-items: center; gap: 4px;
      font-family: var(--font-mono);
      font-size: 10px;
      color: var(--white-40);
    }

    .perf-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--lime); opacity: 0.6; }

    /* â”€â”€â”€ STAT COUNTER BUMP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes statBump {
      0%   { transform: scale(1);    color: var(--line-white); }
      40%  { transform: scale(1.3);  color: var(--lime-bright); text-shadow: 0 0 16px rgba(163,230,53,0.7); }
      100% { transform: scale(1);    color: var(--line-white); }
    }
    .stat-bump { animation: statBump 0.45s cubic-bezier(0.34, 1.56, 0.64, 1) both; }

    /* â”€â”€â”€ MOBILE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 640px) {
      .hero { padding: 28px 16px 16px; }
      h1 { font-size: clamp(48px, 18vw, 72px); }
      .hero-sub { font-size: 13px; padding: 0 8px; }
      .stats-row { gap: 16px 24px; }
      .stat-val { font-size: 22px; }
      .stat-label { font-size: 9px; }
      .chat-wrapper { padding: 0 12px 16px; }
      .messages { max-height: 46vh; min-height: 200px; }
      .msg-bubble { font-size: 13px; padding: 12px 14px; max-width: 100%; }
      .msg-avatar { width: 28px; height: 28px; font-size: 11px; }
      .input-shell { padding: 10px 12px; border-radius: 14px; }
      #question-input { font-size: 14px; }
      .send-btn { width: 34px; height: 34px; }
      .input-footer { flex-direction: column; align-items: flex-start; gap: 8px; }
      .input-hint { align-self: flex-end; }
      .footer-inner { flex-direction: column; align-items: center; text-align: center; gap: 14px; }
      .footer-brand-label { align-items: center; }
      .corner-flag { display: none; }
      .pitch-arc { width: 360px; height: 200px; bottom: -100px; }
    }

    /* â”€â”€â”€ PITCH HALF-CIRCLE DECORATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .pitch-arc {
      position: fixed;
      bottom: -200px; left: 50%;
      transform: translateX(-50%);
      width: 700px; height: 400px;
      border: 1px solid rgba(232,245,234,0.04);
      border-radius: 50%;
      pointer-events: none;
      z-index: 0;
    }

    /* â”€â”€â”€ CORNER FLAG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .corner-flag {
      position: fixed;
      z-index: 0;
      opacity: 0.06;
      pointer-events: none;
    }
    .corner-flag.tl { top: 0; left: 0; }
    .corner-flag.tr { top: 0; right: 0; }
    .corner-flag svg { width: 120px; height: 120px; }
  </style>
</head>
<body>

  <!-- decorative pitch elements -->
  <div class="pitch-bg"></div>
  <div class="pitch-lines"></div>
  <div class="grain"></div>
  <div class="pitch-arc"></div>

  <!-- corner flag decorations -->
  <div class="corner-flag tl">
    <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0 L80 0 L80 4 L4 4 L4 80 L0 80 Z" fill="white"/>
      <circle cx="4" cy="4" r="20" stroke="white" stroke-width="1.5" fill="none"/>
    </svg>
  </div>
  <div class="corner-flag tr" style="transform: scaleX(-1)">
    <svg viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0 L80 0 L80 4 L4 4 L4 80 L0 80 Z" fill="white"/>
      <circle cx="4" cy="4" r="20" stroke="white" stroke-width="1.5" fill="none"/>
    </svg>
  </div>

  <div class="app">

    <!-- HERO -->
    <header class="hero">
      <div class="badge">
        <div class="badge-dot"></div>
        <span>AI-Powered Â· Official IFAB Rules Â· Context-Aware</span>
      </div>
      <h1>FOOTBALL<br><span class="accent">LAW</span></h1>
      <p class="hero-sub">Ask any question about the Laws of the Game â€” powered by AI with context awareness</p>

      <div class="stats-row" id="stats-row">
        <div class="stat">
          <span class="stat-val" id="stat-session">0</span>
          <span class="stat-label">Asked This Session</span>
        </div>
        <div class="stat">
          <span class="stat-val" id="stat-laws">â€”</span>
          <span class="stat-label">Laws Covered</span>
        </div>
        <div class="stat">
          <span class="stat-val" id="stat-queries">â€”</span>
          <span class="stat-label">All-Time Questions</span>
        </div>
        <div class="stat">
          <span class="stat-val">âœ“</span>
          <span class="stat-label">Instant Answers</span>
        </div>
      </div>
    </header>

    <!-- MAIN CHAT -->
    <main class="chat-wrapper">

      <!-- Session controls -->
      <div class="session-controls">
        <div class="session-info">
          <div class="session-indicator"></div>
          <span id="session-status">Session Active</span>
        </div>
        <button class="new-session-btn" onclick="createNewSession()">New Conversation</button>
      </div>

      <div class="pitch-divider">
        <span>KICK OFF</span>
      </div>

      <!-- messages -->
      <div class="messages" id="messages">
        <!-- empty state -->
        <div class="empty-state" id="empty-state">
          <svg class="ball-icon" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="32" cy="32" r="30" stroke="white" stroke-width="2"/>
            <path d="M32 2 L32 12 M32 52 L32 62 M2 32 L12 32 M52 32 L62 32" stroke="white" stroke-width="1.5"/>
            <circle cx="32" cy="32" r="8" fill="white"/>
            <path d="M32 2 C20 8 16 20 22 32 C16 44 20 56 32 62 C44 56 48 44 42 32 C48 20 44 8 32 2Z" stroke="white" stroke-width="1.5" fill="none"/>
          </svg>
          <p>No questions yet. Ask about offside, handball, penalties, red cards, restarts â€” anything from the Laws of the Game. Your conversation is tracked for context-aware follow-ups!</p>
          <div class="suggestions" id="suggestions">
            <button class="suggestion-btn" onclick="useSuggestion(this)">What is the handball rule?</button>
            <button class="suggestion-btn" onclick="useSuggestion(this)">When is a penalty awarded?</button>
            <button class="suggestion-btn" onclick="useSuggestion(this)">Can a goalkeeper score from a goal kick?</button>
            <button class="suggestion-btn" onclick="useSuggestion(this)">What counts as offside?</button>
            <button class="suggestion-btn" onclick="useSuggestion(this)">When is a dropped ball used?</button>
            <button class="suggestion-btn" onclick="useSuggestion(this)">What is a red card offence?</button>
          </div>
        </div>
      </div>

      <!-- input -->
      <div class="input-area">
        <div class="input-shell">
          <textarea
            id="question-input"
            placeholder="Ask about any football lawâ€¦ (context-aware)"
            rows="1"
            onkeydown="handleKeyDown(event)"
            oninput="autoResize(this)"
          ></textarea>
          <button class="send-btn" id="send-btn" onclick="handleSendButton()" title="Send (Enter)">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M14.5 8L1.5 1.5L4 8L1.5 14.5L14.5 8Z"/>
            </svg>
          </button>
        </div>

        <div class="input-footer">
          <div class="input-hint">
            <span class="kbd">Enter</span> send &nbsp; <span class="kbd">Shift+Enter</span> newline
          </div>
        </div>
      </div>

    </main>

    <footer>
      <div class="footer-rule"></div>
      <div class="footer-inner">
        <div class="footer-copy">
          FootballLaw AI &nbsp;Â·&nbsp; <a href="https://www.theifab.com/laws-edition/2024-25/guidelines-and-notes/guidelines-for-match-officials/" target="_blank" rel="noopener">IFAB Laws of the Game</a> &nbsp;Â·&nbsp; RAG v2.5 (Context-Aware)
        </div>
        <a class="footer-brand" href="https://firswoodintelligence.com" target="_blank" rel="noopener" title="Visit Firswood Intelligence">
          <div class="footer-brand-label">
            <span class="footer-brand-built">Built by</span>
            <span class="footer-brand-name">FIRSWOOD INTELLIGENCE</span>
          </div>
          <div class="footer-brand-mark">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="3" width="18" height="18" rx="5" ry="5"></rect>
              <path d="M12 17V7"></path>
              <path d="M9 10l3-3 3 3"></path>
              <path d="M9 13l3-3 3 3"></path>
              <path d="M9 16l3-3 3 3"></path>
            </svg>
          </div>
        </a>
      </div>
    </footer>
  </div>

  <!-- toast -->
  <div class="toast" id="toast"></div>

  <script>
    // â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let isLoading = false;
    let showEvidence = true;
    let includeRawChunks = false;
    let sessionQuestions = 0;
    let currentAbortController = null;
    let currentSessionId = null;
    const API_BASE = () => 'https://fcrules.vercel.app';

    // â”€â”€â”€ SESSION MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function initializeSession() {
      // Check if we have a stored session ID
      currentSessionId = localStorage.getItem('football_law_session_id');
      
      if (!currentSessionId) {
        // Create new session
        await createNewSession();
      } else {
        // Validate existing session
        try {
          const r = await fetch(`${API_BASE()}/session/${currentSessionId}`, { 
            signal: AbortSignal.timeout(4000) 
          });
          if (!r.ok) {
            // Session expired, create new one
            await createNewSession();
          } else {
            updateSessionStatus('active');
          }
        } catch (e) {
          // Error validating, create new session
          await createNewSession();
        }
      }
    }

    async function createNewSession() {
      try {
        const r = await fetch(`${API_BASE()}/session/new`, {
          method: 'POST',
          signal: AbortSignal.timeout(4000)
        });
        
        if (r.ok) {
          const data = await r.json();
          currentSessionId = data.session_id;
          localStorage.setItem('football_law_session_id', currentSessionId);
          updateSessionStatus('active');
          
          // Clear messages
          const messages = document.getElementById('messages');
          messages.innerHTML = `
            <div class="empty-state" id="empty-state">
              <svg class="ball-icon" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="32" cy="32" r="30" stroke="white" stroke-width="2"/>
                <path d="M32 2 L32 12 M32 52 L32 62 M2 32 L12 32 M52 32 L62 32" stroke="white" stroke-width="1.5"/>
                <circle cx="32" cy="32" r="8" fill="white"/>
                <path d="M32 2 C20 8 16 20 22 32 C16 44 20 56 32 62 C44 56 48 44 42 32 C48 20 44 8 32 2Z" stroke="white" stroke-width="1.5" fill="none"/>
              </svg>
              <p>New conversation started! Ask about offside, handball, penalties, red cards, restarts â€” anything from the Laws of the Game.</p>
              <div class="suggestions" id="suggestions">
                <button class="suggestion-btn" onclick="useSuggestion(this)">What is the handball rule?</button>
                <button class="suggestion-btn" onclick="useSuggestion(this)">When is a penalty awarded?</button>
                <button class="suggestion-btn" onclick="useSuggestion(this)">Can a goalkeeper score from a goal kick?</button>
                <button class="suggestion-btn" onclick="useSuggestion(this)">What counts as offside?</button>
                <button class="suggestion-btn" onclick="useSuggestion(this)">When is a dropped ball used?</button>
                <button class="suggestion-btn" onclick="useSuggestion(this)">What is a red card offence?</button>
              </div>
            </div>
          `;
          
          // Reset session counter
          sessionQuestions = 0;
          document.getElementById('stat-session').textContent = '0';
          
          showToast('New conversation started');
        }
      } catch (e) {
        console.error('Failed to create session:', e);
        updateSessionStatus('error');
      }
    }

    function updateSessionStatus(status) {
      const statusEl = document.getElementById('session-status');
      if (status === 'active') {
        statusEl.textContent = 'Session Active';
      } else if (status === 'error') {
        statusEl.textContent = 'Session Error';
      }
    }

    // â”€â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.addEventListener('DOMContentLoaded', async () => {
      await initializeSession();
      fetchStats();
      const input = document.getElementById('question-input');
      autoResize(input);
      
      input.addEventListener('focus', () => {
        setTimeout(() => {
          input.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 300);
      });
    });

    async function fetchStats() {
      try {
        const r = await fetch(`${API_BASE()}/stats`, { signal: AbortSignal.timeout(4000) });
        if (!r.ok) return;
        const d = await r.json();
        document.getElementById('stat-laws').textContent = d.unique_laws?.length ?? 'â€”';

        const allTime = d.all_time_queries ?? d.total_queries_processed ?? null;
        if (allTime !== null) {
          animateCounter('stat-queries', allTime);
        }
      } catch (_) {
        // API not connected
      }
    }

    function animateCounter(id, target) {
      const el = document.getElementById(id);
      const current = parseInt(el.textContent.replace(/,/g, '')) || 0;
      if (current === target) { el.textContent = target.toLocaleString(); return; }
      const duration = 900;
      const start = performance.now();
      const from = current;
      function tick(now) {
        const p = Math.min((now - start) / duration, 1);
        const eased = 1 - Math.pow(1 - p, 3);
        const val = Math.round(from + (target - from) * eased);
        el.textContent = val.toLocaleString();
        if (p < 1) requestAnimationFrame(tick);
        else el.textContent = target.toLocaleString();
      }
      requestAnimationFrame(tick);
    }

    function incrementSessionCounter() {
      sessionQuestions++;
      const el = document.getElementById('stat-session');
      el.textContent = sessionQuestions.toLocaleString();
      el.classList.remove('stat-bump');
      void el.offsetWidth;
      el.classList.add('stat-bump');
    }

    // â”€â”€â”€ SUGGESTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function useSuggestion(btn) {
      const input = document.getElementById('question-input');
      input.value = btn.textContent;
      autoResize(input);
      sendQuestion();
    }

    // â”€â”€â”€ INPUT HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function autoResize(el) {
      el.style.height = 'auto';
      el.style.height = Math.min(el.scrollHeight, 120) + 'px';
    }

    function handleKeyDown(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendQuestion();
      }
    }

    // â”€â”€â”€ SEND QUESTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function sendQuestion() {
      if (isLoading) return;
      const input = document.getElementById('question-input');
      const question = input.value.trim();
      if (!question) return;

      document.getElementById('empty-state')?.remove();
      input.value = '';
      autoResize(input);

      addMessage('user', question);
      incrementSessionCounter();
      setLoading(true);

      const typingId = addTyping();
      currentAbortController = new AbortController();

      try {
        const headers = {
          'Content-Type': 'application/json'
        };
        
        // Add session ID to headers
        if (currentSessionId) {
          headers['X-Session-ID'] = currentSessionId;
        }

        const res = await fetch(`${API_BASE()}/ask`, {
          method: 'POST',
          headers: headers,
          body: JSON.stringify({
            question,
            top_k: 10,
            include_raw_chunks: includeRawChunks
          }),
          signal: currentAbortController.signal
        });

        removeTyping(typingId);

        if (!res.ok) {
          const err = await res.json().catch(() => ({ detail: `HTTP ${res.status}` }));
          throw new Error(err.detail || 'API error');
        }

        const data = await res.json();
        
        // Update session ID if returned
        if (data.session_id && data.session_id !== 'none') {
          currentSessionId = data.session_id;
          localStorage.setItem('football_law_session_id', currentSessionId);
        }
        
        addAIMessage(data);
        fetchStats();

      } catch (err) {
        removeTyping(typingId);
        if (err.name !== 'AbortError') {
          addMessage('error', `âš ï¸ ${err.message || 'Could not connect to API.'}`);
          showToast('Error: ' + (err.message || 'Could not reach API'), true);
        }
      } finally {
        setLoading(false);
        currentAbortController = null;
      }
    }

    // â”€â”€â”€ BUILD USER BUBBLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addMessage(type, text) {
      const messages = document.getElementById('messages');
      const wrap = document.createElement('div');
      wrap.className = `msg ${type === 'user' ? 'user' : 'ai'}`;

      const now = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      if (type === 'user') {
        wrap.innerHTML = `
          <div class="msg-avatar">YOU</div>
          <div class="msg-body">
            <div class="msg-bubble">${escHtml(text)}</div>
            <div class="msg-meta">${now}</div>
          </div>`;
      } else {
        wrap.innerHTML = `
          <div class="msg-avatar">âš½</div>
          <div class="msg-body">
            <div class="msg-bubble" style="color: var(--red-card)">${escHtml(text)}</div>
            <div class="msg-meta">${now}</div>
          </div>`;
      }
      messages.appendChild(wrap);
      scrollBottom();
    }

    // â”€â”€â”€ BUILD AI RESPONSE BUBBLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addAIMessage(data) {
      const messages = document.getElementById('messages');
      const now = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      const ms = data.processing_time_ms ? Math.round(data.processing_time_ms) : null;

      // Check if this was a follow-up question
      const isFollowUp = data.retrieval_info?.is_follow_up || false;
      const contextBadge = isFollowUp ? '<span class="context-badge">ğŸ”— Context-Aware</span>' : '';

      const wrap = document.createElement('div');
      wrap.className = 'msg ai';
      wrap.innerHTML = `
        <div class="msg-avatar">âš½</div>
        <div class="msg-body">
          <div class="msg-bubble">
            ${contextBadge ? `<div style="margin-bottom:8px">${contextBadge}</div>` : ''}
            <div class="ai-answer"></div>
          </div>
          <div class="msg-meta">
            ${now}
            ${ms ? `<span class="perf-badge"><span class="perf-dot"></span>${ms}ms</span>` : ''}
          </div>
        </div>`;

      messages.appendChild(wrap);
      
      requestAnimationFrame(() => {
        wrap.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });

      const answerDiv = wrap.querySelector('.ai-answer');
      streamText(answerDiv, data.answer, () => {
        if (showEvidence && data.evidence && data.evidence.length > 0) {
          const items = data.evidence.slice(0, 5).map(e => `
            <div class="evidence-item">
              <div class="evidence-cite">${escHtml(e.citation)}</div>
              <div class="evidence-text">${escHtml(e.text_preview)}</div>
              ${e.full_text ? `<div class="evidence-text" style="margin-top:6px;opacity:0.6;font-size:11px">${escHtml(e.full_text.slice(0, 400))}â€¦</div>` : ''}
            </div>
          `).join('');

          const evidenceHtml = `
            <button class="evidence-toggle" onclick="toggleEvidence(this)">
              <span>Sources (${data.evidence.length})</span>
              <span class="chevron">â–¾</span>
            </button>
            <div class="evidence-panel">${items}</div>
          `;
          
          const bubble = wrap.querySelector('.msg-bubble');
          bubble.insertAdjacentHTML('beforeend', evidenceHtml);
        }
      });
    }

    // â”€â”€â”€ STREAM TEXT WITH TYPING EFFECT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function streamText(element, text, onComplete) {
      if (!text) {
        if (onComplete) onComplete();
        return;
      }

      let index = 0;
      const chunkSize = 5;
      const delay = 8;

      function addChunk() {
        if (index < text.length) {
          index += chunkSize;
          const currentText = text.slice(0, index);
          const formattedText = formatAnswer(currentText);
          element.innerHTML = formattedText;
          setTimeout(addChunk, delay);
        } else {
          element.innerHTML = formatAnswer(text);
          if (onComplete) onComplete();
        }
      }

      addChunk();
    }

    // â”€â”€â”€ FORMAT ANSWER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function formatAnswer(text) {
      if (!text) return '';
      let out = escHtml(text);

      // Convert markdown bold **text** to HTML
      out = out.replace(/\*\*(.+?)\*\*/g, '<strong style="color:var(--lime-bright);font-weight:600">$1</strong>');

      // bold section headers
      out = out.replace(/^(\d+\))\s+(.+)$/gm, '<strong style="color:var(--lime-bright)">$1 $2</strong>');

      // bold keywords
      out = out.replace(/(Decision|Restart|Discipline|Evidence):/g,
        '<strong style="color:var(--line-white);opacity:0.9">$1:</strong>');

      // highlight card mentions
      out = out.replace(/\byellow card\b/gi, '<span style="color:var(--yellow-card);font-weight:600">Yellow Card</span>');
      out = out.replace(/\bred card\b/gi, '<span style="color:var(--red-card);font-weight:600">Red Card</span>');

      // quote blocks
      out = out.replace(/&quot;([^&]+)&quot;/g, '<span style="font-style:italic;color:var(--white-70)">"$1"</span>');

      return out;
    }

    // â”€â”€â”€ EVIDENCE TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleEvidence(btn) {
      btn.classList.toggle('open');
      const panel = btn.nextElementSibling;
      panel.classList.toggle('open');
    }

    // â”€â”€â”€ TYPING INDICATOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let typingCounter = 0;
    function addTyping() {
      const id = 'typing-' + (++typingCounter);
      const messages = document.getElementById('messages');
      const wrap = document.createElement('div');
      wrap.className = 'msg ai';
      wrap.id = id;
      wrap.innerHTML = `
        <div class="msg-avatar">âš½</div>
        <div class="msg-body">
          <div class="typing-indicator">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
        </div>`;
      messages.appendChild(wrap);
      scrollBottom();
      return id;
    }

    function removeTyping(id) {
      document.getElementById(id)?.remove();
    }

    // â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function handleSendButton() {
      if (isLoading) {
        stopCurrentRequest();
      } else {
        sendQuestion();
      }
    }

    function stopCurrentRequest() {
      if (currentAbortController) {
        currentAbortController.abort();
        showToast('Request cancelled');
      }
    }

    function setLoading(v) {
      isLoading = v;
      const btn = document.getElementById('send-btn');
      btn.disabled = false;
      if (v) {
        btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><rect x="4" y="4" width="8" height="8" rx="1"/></svg>`;
        btn.title = 'Stop';
      } else {
        btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M14.5 8L1.5 1.5L4 8L1.5 14.5L14.5 8Z"/></svg>`;
        btn.title = 'Send (Enter)';
      }
    }

    function scrollBottom() {
      const m = document.getElementById('messages');
      requestAnimationFrame(() => { m.scrollTop = m.scrollHeight; });
    }

    function escHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
    }

    // â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let toastTimer;
    function showToast(msg, isError = false) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.className = 'toast show' + (isError ? ' error' : '');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => { t.className = 'toast'; }, 3500);
    }
  </script>
</body>
</html>
